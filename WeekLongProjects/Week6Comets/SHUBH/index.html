<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Falling Blocks Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    canvas {
      border: 5px solid sandybrown;
      display: block;
      margin: 20px auto;
      background-color: #eee;
    }
    #scoreboard {
      font-size: 20px;
      margin-top: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 20px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Falling Blocks Game</h1>

  <!-- Falling Blocks Game -->
  <div id="game1Container">
    <h2>Falling Blocks Game</h2>
    <canvas id="fallingCanvas" width="800" height="600"></canvas>
    <div id="fallingScoreboard">
      Score: <span id="fallingScore">0</span> |
      High Score: <span id="fallingHighScore">0</span> |
      Missed Rainbow: <span id="missedRainbow">0</span>/3
    </div>
    <button id="fallingPlayAgainBtn">Play Again</button>
  </div>

  <script>
    // --- Falling Blocks Game Logic ---
    const fallingCanvas = document.getElementById("fallingCanvas");
    const fallingCtx = fallingCanvas.getContext("2d");
    const fallingScoreDisplay = document.getElementById("fallingScore");
    const fallingHighScoreDisplay = document.getElementById("fallingHighScore");
    const fallingPlayAgainBtn = document.getElementById("fallingPlayAgainBtn");

    let fallingScore = 0;
    let fallingHighScore = localStorage.getItem("fallingHighScore") || 0;
    let missedRainbow = 0;
    let fallingGameOver = false;

    fallingHighScoreDisplay.textContent = fallingHighScore;

    const fallingPaddle = {
      x: fallingCanvas.width / 2 - 40,
      y: fallingCanvas.height - 20,
      width: 80,
      height: 10,
      color: "black",
      speed: 5
    };

    let fallingItems = [];
    let frameCount = 0;
    let difficultySpeed = 1;
    let lastSpeedIncreaseTime = Date.now();

    document.addEventListener("mousemove", e => {
      const rect = fallingCanvas.getBoundingClientRect();
      let mouseX = e.clientX - rect.left;
      fallingPaddle.x = mouseX - fallingPaddle.width / 2;
    });

    fallingPlayAgainBtn.addEventListener("click", () => {
      fallingScore = 0;
      missedRainbow = 0;
      fallingItems = [];
      fallingGameOver = false;
      frameCount = 0;
      fallingScoreDisplay.textContent = fallingScore;
      fallingPlayAgainBtn.style.display = "none";
      requestAnimationFrame(fallingGameLoop);
    });

    function getRandomItem() {
      const rand = Math.random();
      if (rand < 0.0667) return { color: "rainbow", points: 0 }; // 1 in 15 ratio (~6.67%)
      else if (rand < 0.2667) return { color: "green", points: 5 };
      else if (rand < 0.4667) return { color: "red", points: -3 };
      else return { color: "blue", points: 10 };
    }

    function drawPaddle() {
      fallingCtx.fillStyle = fallingPaddle.color;
      fallingCtx.fillRect(fallingPaddle.x, fallingPaddle.y, fallingPaddle.width, fallingPaddle.height);
    }

    function drawItem(item) {
      if (item.color === "rainbow") {
        item.hue = (item.hue + 2) % 360;
        fallingCtx.fillStyle = `hsl(${item.hue}, 100%, 50%)`;
      } else {
        fallingCtx.fillStyle = item.color;
      }
      fallingCtx.fillRect(item.x, item.y, item.size, item.size);
    }

    function fallingGameLoop() {
      if (fallingGameOver) return;

      fallingCtx.clearRect(0, 0, fallingCanvas.width, fallingCanvas.height);
      drawPaddle();

      if (frameCount % 10 === 0) {
        const spawnCount = 3; // number of items to spawn at once
        for (let i = 0; i < spawnCount; i++) {
          const type = getRandomItem();
          fallingItems.push({
            ...type,
            x: Math.random() * (fallingCanvas.width - 40),
            y: -40,
            size: type.color === "rainbow" ? 40 : 20,
            speed: (2 + Math.random() * 2) * difficultySpeed,
            hue: 0
          });
        }
      }

      const now = Date.now();
      if (now - lastSpeedIncreaseTime >= 30000) {
        difficultySpeed *= 1.35;
        lastSpeedIncreaseTime = now;
      }

      for (let i = fallingItems.length - 1; i >= 0; i--) {
        const item = fallingItems[i];
        item.y += item.speed;
        drawItem(item);

        if (item.y + item.size >= fallingPaddle.y &&
            item.x + item.size >= fallingPaddle.x &&
            item.x <= fallingPaddle.x + fallingPaddle.width) {
          if (item.color === "rainbow") {
            missedRainbow = 0;
          } else {
            fallingScore += item.points;
          }
          fallingItems.splice(i, 1);
        } else if (item.y > fallingCanvas.height) {
          if (item.color === "rainbow") {
            missedRainbow++;
            if (missedRainbow >= 3) {
              endFallingGame();
              return;
            }
          }
          fallingItems.splice(i, 1);
        }
      }

      fallingScoreDisplay.textContent = fallingScore;
      fallingPlayAgainBtn.style.display = "none";
      frameCount++;
      requestAnimationFrame(fallingGameLoop);
    }

    function endFallingGame() {
      fallingGameOver = true;
      fallingCtx.fillStyle = "rgba(0,0,0,0.6)";
      fallingCtx.fillRect(0, 0, fallingCanvas.width, fallingCanvas.height);
      fallingCtx.fillStyle = "white";
      fallingCtx.font = "24px Arial";
      fallingCtx.textAlign = "center";
      fallingCtx.fillText("Game Over", fallingCanvas.width / 2, fallingCanvas.height / 2 - 20);

      if (fallingScore > fallingHighScore) {
        fallingHighScore = fallingScore;
        localStorage.setItem("fallingHighScore", fallingHighScore);
        fallingCtx.fillText("New High Score!", fallingCanvas.width / 2, fallingCanvas.height / 2 + 10);
      } else {
        fallingCtx.fillText(`Your Score: ${fallingScore}`, fallingCanvas.width / 2, fallingCanvas.height / 2 + 10);
        fallingCtx.fillText(`High Score: ${fallingHighScore}`, fallingCanvas.width / 2, fallingCanvas.height / 2 + 40);
      }

      fallingHighScoreDisplay.textContent = fallingHighScore;
      fallingScoreDisplay.textContent = fallingScore;
      fallingPlayAgainBtn.style.display = "block";
    }

    // Start the game when the page loads
    requestAnimationFrame(fallingGameLoop);
  </script>
</body>
</html>
