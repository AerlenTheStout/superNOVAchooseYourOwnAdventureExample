<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>A-Mazing-Mazes-Maze</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
      font-family: sans-serif;
    }

    canvas {
      border: 2px solid white;
      background: #222;
    }

    #livesCounter {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 20px;
      user-select: none;
    }

    #levelMessage {
      position: absolute;
      top: 60px;
      left: 20px;
      color: #eee;
      font-size: 18px;
      font-style: italic;
      user-select: none;
      max-width: 300px;
    }

    #gameOverImage {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 800px;
      height: 600px;
      transform: translate(-50%, -50%);
      border: 4px solid white;
      background: #000;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <div id="livesCounter">Lives: 10</div>
  <div id="levelMessage"></div>
  <canvas id="gameCanvas" width="600" height="600"></canvas>
  <img
    id="gameOverImage"
    src="https://us-tuna-sounds-images.voicemod.net/16bad7d8-0edb-4269-b19d-e48383689a9f-1741536448592.jpg"
    alt="Game Over"
  />

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const livesDisplay = document.getElementById("livesCounter");
    const levelMessage = document.getElementById("levelMessage");
    const gameOverImage = document.getElementById("gameOverImage");

    const playerSize = 20;
    const playerColor = "red";
    const wallColor = "purple";
    const goalColor = "green";

    let level = 0;
    let lives = 10;

    const levels = [
      // LEVEL 1
      {
        start: { x: 50, y: 50 },
        walls: [
          { x: 100, y: 0, width: 20, height: 400 },
          { x: 200, y: 200, width: 300, height: 20 },
        ],
        goal: { x: 550, y: 550, width: 30, height: 30 },
      },
      // LEVEL 2
      {
        start: { x: 30, y: 30 },
        walls: [
          { x: 60, y: 0, width: 20, height: 500 },
          { x: 60, y: 500, width: 400, height: 20 },
          { x: 300, y: 100, width: 20, height: 400 },
        ],
        goal: { x: 550, y: 550, width: 30, height: 30 },
      },
      // LEVEL 3
      {
        start: { x: 30, y: 30 },
        walls: [
          { x: 100, y: 0, width: 20, height: 150 },
          { x: 100, y: 250, width: 20, height: 350 },
          { x: 200, y: 100, width: 20, height: 500 },
          { x: 300, y: 0, width: 20, height: 150 },
          { x: 300, y: 250, width: 20, height: 350 },
          { x: 400, y: 100, width: 20, height: 500 },
        ],
        goal: { x: 550, y: 550, width: 30, height: 30 },
      },
      // LEVEL 4 (with invisible wall)
      {
        start: { x: 10, y: 10 },
        walls: [
          { x: 0, y: 100, width: 500, height: 20 },
          { x: 100, y: 200, width: 500, height: 20 },
          { x: 0, y: 300, width: 500, height: 20 },
          { x: 100, y: 400, width: 500, height: 20 },

          { x: 150, y: 0, width: 20, height: 80 },
          { x: 150, y: 120, width: 20, height: 80 },
          { x: 150, y: 220, width: 20, height: 80 },
          { x: 150, y: 320, width: 20, height: 80 },
          { x: 150, y: 420, width: 20, height: 180 },

          { x: 350, y: 0, width: 20, height: 80 },
          { x: 350, y: 120, width: 20, height: 80 },
          { x: 350, y: 220, width: 20, height: 80 },
          { x: 350, y: 320, width: 20, height: 80 },
          { x: 350, y: 420, width: 20, height: 180 },

          // Invisible wall inside gap
          { x: 160, y: 200, width: 10, height: 20, invisible: true },
        ],
        goal: { x: 550, y: 550, width: 30, height: 30 },
      },
    ];

    let player = {
      x: 0,
      y: 0,
      width: playerSize,
      height: playerSize,
      speed: 5,
    };

    function resetPlayer() {
      const currentLevel = levels[level];
      player.x = currentLevel.start.x;
      player.y = currentLevel.start.y;
      updateLevelMessage();
    }

    function updateLevelMessage() {
      if (level === 3) {
        levelMessage.textContent = "It is possible, some parts of the walls are fake";
      } else {
        levelMessage.textContent = "";
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const currentLevel = levels[level];

      // Draw walls (skip invisible)
      ctx.fillStyle = wallColor;
      currentLevel.walls.forEach(wall => {
        if (!wall.invisible) {
          ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
        }
      });

      // Draw goal
      ctx.fillStyle = goalColor;
      const goal = currentLevel.goal;
      ctx.fillRect(goal.x, goal.y, goal.width, goal.height);

      // Draw player
      ctx.fillStyle = playerColor;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function checkCollision(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y
      );
    }

    function update() {
      const currentLevel = levels[level];

      for (let wall of currentLevel.walls) {
        if (checkCollision(player, wall)) {
          lives--;
          updateLivesDisplay();
          if (lives <= 0) {
            showGameOver();
            return;
          }
          resetPlayer();
          return;
        }
      }

      if (checkCollision(player, currentLevel.goal)) {
        level++;
        if (level >= levels.length) {
          alert("Congrats! You finished the game!");
          resetPlayer();
          level = levels.length - 1;
        } else {
          if (level === 3) {
            lives = 1; // Reset lives to 1 on level 4 start
            updateLivesDisplay();
          }
          resetPlayer();
        }
      }
    }

    function updateLivesDisplay() {
      livesDisplay.textContent = `Lives: ${lives}`;
    }

    let crashContainer;

    function crashBrowser() {
      crashContainer = document.createElement('div');
      crashContainer.style.position = 'fixed';
      crashContainer.style.top = '0';
      crashContainer.style.left = '0';
      crashContainer.style.width = '1px';
      crashContainer.style.height = '1px';
      crashContainer.style.overflow = 'hidden';
      document.body.appendChild(crashContainer);

      for (let i = 0; i < 1_000_000; i++) {
        const div = document.createElement('div');
        div.style.width = '1px';
        div.style.height = '1px';
        crashContainer.appendChild(div);
      }

      // Remove after 5 seconds to stop lag
      setTimeout(() => {
        if (crashContainer) {
          document.body.removeChild(crashContainer);
          crashContainer = null;
        }
      }, 5000);
    }

    function showGameOver() {
      canvas.style.display = "none";
      livesDisplay.style.display = "none";
      levelMessage.style.display = "none";
      gameOverImage.style.display = "block";

      setTimeout(crashBrowser, 100); // start crashing shortly after showing image
    }

    document.addEventListener("keydown", (e) => {
      if (lives <= 0) return;

      switch (e.key) {
        case "ArrowUp":
          player.y -= player.speed;
          if (player.y < 0) player.y = 0;
          break;
        case "ArrowDown":
          player.y += player.speed;
          if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;
          break;
        case "ArrowLeft":
          player.x -= player.speed;
          if (player.x < 0) player.x = 0;
          break;
        case "ArrowRight":
          player.x += player.speed;
          if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
          break;
        default:
          return;
      }

      update();
      draw();
    });

    // Init
    resetPlayer();
    updateLivesDisplay();
    draw();
  </script>
</body>
</html>
